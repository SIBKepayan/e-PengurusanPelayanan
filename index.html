<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280"> 
    <title>Sistem e-Pengurusan Pelayanan SIB Kepayan</title>
    <link rel="stylesheet" href="style.css?v=6.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> </head>
<body>

    <section id="auth-page" class="view active">
        <div class="login-wrapper">
            <div class="login-box">
                <div class="login-header">
                    <img src="logo.png" alt="Logo SIB" class="login-logo">
                    <h2>Sistem e-Pengurusan Pelayanan</h2>
                    <h3>SIB Kepayan</h3>
                </div>
                <form id="loginForm">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="loginId" placeholder="Nama Pengguna" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="loginPass" placeholder="Kata Laluan" required>
                    </div>
                    <button type="submit" class="btn-login">LOG MASUK</button>
                    <p class="login-note">Default Password Ahli Baru: 12345</p>
                </form>
            </div>
        </div>
    </section>

    <section id="dashboard-page" class="view hidden">
        <div class="dashboard-wrapper">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="logo.png" alt="Logo Kecil">
                    <div>
                        <h4>SIB Kepayan</h4>
                        <p id="user-role-display">Role</p>
                    </div>
                </div>
                <ul class="menu">
                    <li onclick="showTab('tab-home')" class="active"><i class="fas fa-calendar-alt"></i> Jadual Mingguan</li>
                    
                    <li id="menu-kehadiran" onclick="showTab('tab-kehadiran')"><i class="fas fa-chart-bar"></i> Kehadiran Jemaat</li>
                    
                    <li id="menu-tim" onclick="showTab('tab-urus-tim')"><i class="fas fa-users-cog"></i> Data Tim Pelayanan</li>
                    <li id="menu-ibadah" onclick="showTab('tab-urus-ibadah')"><i class="fas fa-church"></i> Urus Ibadah Utama</li>
                    <li id="menu-cabang" onclick="showTab('tab-urus-cabang')"><i class="fas fa-network-wired"></i> Urus Jadual Cabang</li>
                    
                    <li onclick="showTab('tab-profile')"><i class="fas fa-key"></i> Tukar Kata Laluan</li>
                    <li onclick="logout()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Log Keluar</li>
                </ul>
            </aside>

            <main class="main-content">
                <header>
                    <h2 id="page-title">Laman Utama</h2>
                    <div class="user-info">
                        <span id="username-display">User</span>
                        <i class="fas fa-user-circle fa-2x"></i>
                    </div>
                </header>

                <div id="tab-home" class="content-tab active">
                    <div class="toolbar">
                        <div class="date-filter">
                            <label>Minggu:</label>
                            <input type="date" id="weekFilterDate" onchange="loadWeeklySchedule()">
                        </div>
                        <button class="btn-primary" onclick="exportWeeklyPDF()"><i class="fas fa-file-pdf"></i> Export PDF</button>
                    </div>
                    <div id="weekly-schedule-container"></div>
                </div>

                <div id="tab-kehadiran" class="content-tab">
                    <h3>Modul Kehadiran Jemaat</h3>
                    
                    <div id="form-kehadiran-wrapper" class="card-form hidden">
                        <h4>Isi Kehadiran Baru</h4>
                        <form id="formAttendance">
                            <div class="form-row">
                                <div class="form-group"><label>Tarikh</label><input type="date" id="attDate" required></div>
                                <div class="form-group"><label>Jumlah PKK (Kanak-Kanak)</label><input type="number" id="attPKK" value="0" required></div>
                                <div class="form-group"><label>Jumlah Jemaat Umum</label><input type="number" id="attUmum" value="0" required></div>
                            </div>
                            <button type="submit" class="btn-primary">Simpan Data</button>
                        </form>
                    </div>

                    <div class="card-form">
                        <div class="toolbar" style="margin-bottom:20px; box-shadow:none; padding:0;">
                            <h4>Analisis Kehadiran</h4>
                            <select id="chartFilter" onchange="loadAttendanceChart()" style="padding:5px;">
                                <option value="weekly">Mingguan (4 Minggu Terkini)</option>
                                <option value="monthly">Bulanan (Tahun Ini)</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                        <canvas id="attendanceChart" style="max-height: 400px;"></canvas>
                    </div>
                </div>

                <div id="tab-urus-tim" class="content-tab">
                    <h3>Data Tim Pelayanan</h3>
                    
                    <div class="toolbar">
                        <input type="text" id="searchTeam" placeholder="Cari Nama / Jawatan..." onkeyup="filterTeamTable()" style="width:100%; padding:10px;">
                    </div>

                    <div class="card-form">
                        <h4>Tambah / Kemaskini Ahli</h4>
                        <form id="teamForm">
                            <input type="hidden" id="teamMemberId"> 
                            <div class="form-row">
                                <div class="form-group"><label>Nama Penuh</label><input type="text" id="teamName" required></div>
                                <div class="form-group"><label>No. Telefon</label><input type="text" id="teamPhone" required></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Jawatan</label>
                                    <select id="teamRole" required>
                                        <option value="">-- Pilih --</option>
                                        <option value="Ahli Majlis Gereja">Ahli Majlis Gereja</option>
                                        <option value="Pengerusi Cabang Pelayanan">Pengerusi Cabang Pelayanan</option>
                                        <option value="Koordinator Kelompok Sel">Koordinator Kelompok Sel</option>
                                        <option value="PMM">PMM (Muda-Mudi)</option>
                                        <option value="P. Wanita">P. Wanita</option>
                                        <option value="PKK">PKK (Kanak-Kanak)</option>
                                        <option value="P. Wira">P. Wira</option>
                                        <option value="MASM">MASM</option>
                                        <option value="Usher">Usher / Penyambut Tetamu</option>
                                    </select>
                                </div>
                                <div class="form-group"><label>Status</label>
                                    <select id="teamStatus" required>
                                        <option value="Aktif">Aktif</option>
                                        <option value="Cuti">Cuti/Rehat</option>
                                        <option value="Tidak Aktif">Tidak Aktif</option>
                                    </select>
                                </div>
                            </div>
                            <div id="super-admin-fields" class="hidden" style="background:#e3f2fd; padding:15px; border-radius:5px; margin-bottom:15px;">
                                <h4>Tetapan Akaun Pengguna (Super Admin Sahaja)</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Username (Biarkan kosong jika tiada akses)</label>
                                        <input type="text" id="teamUsername" placeholder="Cth: sipai">
                                    </div>
                                    <div class="form-group">
                                        <label>Password (Default: 12345)</label>
                                        <input type="text" id="teamPassword" placeholder="12345">
                                    </div>
                                    <div class="form-group">
                                        <label>Jenis Akses</label>
                                        <select id="teamAccessLevel">
                                            <option value="none">Tiada Akses Login</option>
                                            <option value="council">Ahli Majlis Gereja</option>
                                            <option value="usher">Usher</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn-primary">Simpan Data</button>
                            <button type="button" class="btn-secondary" onclick="resetTeamForm()">Batal</button>
                        </form>
                    </div>

                    <div class="table-responsive">
                        <table id="teamTable" class="std-table">
                            <thead><tr><th>Nama</th><th>Jawatan</th><th>Akses</th><th>Status</th><th>Tindakan</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-urus-ibadah" class="content-tab">
                    <div class="tab-switcher">
                        <button class="btn-secondary active" onclick="switchSubTab('sub-ahad')">Ibadah Umum Ahad</button>
                        <button class="btn-secondary" onclick="switchSubTab('sub-doa')">Persekutuan Doa</button>
                        <button class="btn-secondary" onclick="switchSubTab('sub-khas')">Ibadah Khas</button>
                    </div>

                    <div id="sub-ahad" class="sub-tab active">
                        <form id="formAhad">
                            <h4>Ibadah Umum Ahad</h4>
                            <div class="form-group"><label>Tarikh</label><input type="date" id="dateAhad" required></div>
                            <div class="form-row">
                                <div class="form-group"><label>Pimpin Ibadah</label><select class="member-select" id="valAhadLeader"></select></div>
                                <div class="form-group"><label>Pimpin Pujian</label><select class="member-select" id="valAhadWorship"></select></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Khotbah</label><select class="member-select" id="valAhadSpeaker"></select></div>
                                <div class="form-group"><label>Doa PKK</label><select class="member-select" id="valAhadDoaPKK"></select></div>
                            </div>
                            <div class="form-group"><label>Penyambut Tetamu (Ahli Majlis/Wira/Wanita/Muda-Mudi/PKK Sahaja)</label><select class="usher-select" id="valAhadUsher"></select></div>
                            
                            <div class="form-group checkbox-group"><input type="checkbox" id="checkPerjamuan" onchange="togglePerjamuan('divPerjamuan')"> <label>Perjamuan Kudus?</label></div>
                            <div id="divPerjamuan" class="hidden form-row">
                                <div class="form-group"><label>Ketua PK</label><select class="member-select" id="valAhadPK"></select></div>
                                <div class="form-group"><label>Pembantu PK</label><select class="member-select" id="valAhadAsstPK"></select></div>
                            </div>
                            <fieldset><legend>Alkitab</legend>
                                <div class="form-row">
                                    <div class="form-group"><label>Nama (PL)</label><select class="member-select" id="valReaderOT"></select></div>
                                    <div class="form-group"><label>Ayat (PL)</label><input type="text" id="valVerseOT"></div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group"><label>Nama (PB)</label><select class="member-select" id="valReaderNT"></select></div>
                                    <div class="form-group"><label>Ayat (PB)</label><input type="text" id="valVerseNT"></div>
                                </div>
                            </fieldset>
                            <button type="submit" class="btn-primary">Simpan Ahad</button>
                        </form>
                    </div>

                    <div id="sub-doa" class="sub-tab hidden">
                        <form id="formDoa">
                            <h4>Persekutuan Doa</h4>
                            <div class="form-group"><label>Tarikh</label><input type="date" id="dateDoa" required></div>
                            <div class="form-group checkbox-group"><input type="checkbox" id="checkNoDoa" onchange="toggleDoaAlt()"> <label>Tiada Persekutuan?</label></div>
                            <div id="divDoaNormal">
                                <div class="form-group"><label>Pimpin Pujian</label><select class="member-select" id="valDoaPujian"></select></div>
                                <div class="form-group"><label>Bahan Doa</label><select class="member-select" id="valDoaBahan"></select></div>
                                <div class="form-group"><label>Renungan</label><select class="member-select" id="valDoaRenungan"></select></div>
                            </div>
                            <div id="divDoaAlt" class="hidden"><div class="form-group"><label>Catatan</label><input type="text" id="valDoaActivity"></div></div>
                            <button type="submit" class="btn-primary">Simpan Doa</button>
                        </form>
                    </div>

                    <div id="sub-khas" class="sub-tab hidden">
                        <form id="formKhas">
                            <h4>Ibadah Khas</h4>
                            <div class="form-row">
                                <div class="form-group"><label>Tajuk Ibadah</label><input type="text" id="valKhasName" required></div>
                                <div class="form-group"><label>Tarikh</label><input type="date" id="dateKhas" required></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Pimpin</label><select class="member-select" id="valKhasLeader"></select></div>
                                <div class="form-group"><label>Pujian</label><select class="member-select" id="valKhasWorship"></select></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Khotbah</label><select class="member-select" id="valKhasSpeaker"></select></div>
                                <div class="form-group"><label>Doa PKK</label><select class="member-select" id="valKhasDoaPKK"></select></div>
                            </div>
                            <div class="form-group"><label>Usher</label><select class="usher-select" id="valKhasUsher"></select></div>
                            <div class="form-group checkbox-group"><input type="checkbox" id="checkPerjamuanKhas" onchange="togglePerjamuan('divPerjamuanKhas')"> <label>Perjamuan?</label></div>
                            <div id="divPerjamuanKhas" class="hidden form-row">
                                <div class="form-group"><label>Ketua PK</label><select class="member-select" id="valKhasPK"></select></div>
                                <div class="form-group"><label>Asst PK</label><select class="member-select" id="valKhasAsstPK"></select></div>
                            </div>
                            <fieldset><legend>Alkitab</legend>
                                <div class="form-row"><div class="form-group"><label>Nama (PL)</label><select class="member-select" id="valKhasReaderOT"></select></div><div class="form-group"><label>Ayat (PL)</label><input type="text" id="valKhasVerseOT"></div></div>
                                <div class="form-row"><div class="form-group"><label>Nama (PB)</label><select class="member-select" id="valKhasReaderNT"></select></div><div class="form-group"><label>Ayat (PB)</label><input type="text" id="valKhasVerseNT"></div></div>
                            </fieldset>
                            <div class="form-group"><label>Nota</label><textarea id="valKhasNote" rows="2"></textarea></div>
                            <button type="submit" class="btn-primary">Simpan Khas</button>
                        </form>
                    </div>
                </div>

                <div id="tab-urus-cabang" class="content-tab">
                    <form id="formCabang">
                        <h3>Jadual Cabang</h3>
                        <div class="form-row">
                            <div class="form-group"><label>Cabang</label><select id="valCabangType" onchange="toggleCabangFields()" required><option value="Wira">Wira</option><option value="Wanita">Wanita</option><option value="Muda-Mudi">Muda-Mudi</option><option value="Kanak-Kanak">Kanak-Kanak</option></select></div>
                            <div class="form-group"><label>Tarikh</label><input type="date" id="dateCabang" required></div>
                        </div>
                        <div id="fieldsStandard"><div class="form-group"><label>Aktiviti</label><input type="text" id="valCabangActivity"></div><div class="form-group"><label>Pujian</label><select class="member-select" id="valCabangPujian"></select></div><div class="form-group"><label>Renungan</label><select class="member-select" id="valCabangRenungan"></select></div></div>
                        <div id="fieldsKids" class="hidden"><div class="form-group"><label>Besar</label><select class="member-select" id="valKidsBig"></select></div><div class="form-group"><label>Tengah</label><select class="member-select" id="valKidsMid"></select></div><div class="form-group"><label>Kecil</label><select class="member-select" id="valKidsSmall"></select></div></div>
                        <button type="submit" class="btn-primary">Simpan Cabang</button>
                    </form>
                </div>

                <div id="tab-profile" class="content-tab">
                    <h3>Tukar Kata Laluan</h3>
                    <div class="card-form" style="max-width:500px">
                        <form id="formPassword">
                            <div class="form-group"><label>Kata Laluan Baru</label><input type="password" id="newPassword" required></div>
                            <button type="submit" class="btn-primary">Tukar</button>
                        </form>
                    </div>
                </div>

            </main>
        </div>
    </section>

    <script type="module" src="script.js?v=6.0"></script>
</body>
</html>
