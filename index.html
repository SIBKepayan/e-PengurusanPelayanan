<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem e-Pengurusan Pelayanan SIB Kepayan</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

    <section id="auth-page" class="view active">
        <div class="login-wrapper">
            <div class="login-box">
                <div class="login-header">
                    <img src="logo.png" alt="Logo SIB" class="login-logo">
                    <h2>Sistem e-Pengurusan Pelayanan</h2>
                    <h3>SIB Kepayan</h3>
                </div>
                <form id="loginForm">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="loginId" placeholder="Nama Pengguna / No. Telefon" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="loginPass" placeholder="Kata Laluan" required>
                    </div>
                    <button type="submit" class="btn-login">LOG MASUK</button>
                </form>
            </div>
        </div>
    </section>

    <section id="dashboard-page" class="view hidden">
        <div class="dashboard-wrapper">
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="logo.png" alt="Logo Kecil">
                    <div>
                        <h4>SIB Kepayan</h4>
                        <p id="user-role-display">User</p>
                    </div>
                </div>
                <ul class="menu">
                    <li onclick="showTab('tab-home')" class="active"><i class="fas fa-calendar-alt"></i> Jadual Mingguan</li>
                    
                    <li class="admin-only" onclick="showTab('tab-urus-tim')"><i class="fas fa-users-cog"></i> Data Tim Pelayanan</li>
                    <li class="admin-only" onclick="showTab('tab-urus-ibadah')"><i class="fas fa-church"></i> Urus Ibadah Utama</li>
                    <li class="admin-only" onclick="showTab('tab-urus-cabang')"><i class="fas fa-network-wired"></i> Urus Jadual Cabang</li>
                    
                    <li onclick="showTab('tab-profile')"><i class="fas fa-key"></i> Tukar Kata Laluan</li>
                    <li onclick="logout()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Log Keluar</li>
                </ul>
            </aside>

            <main class="main-content">
                <header>
                    <h2 id="page-title">Jadual Mingguan</h2>
                    <div class="user-info">
                        <span id="username-display">User</span>
                        <i class="fas fa-user-circle fa-2x"></i>
                    </div>
                </header>

                <div id="tab-home" class="content-tab active">
                    <div class="toolbar">
                        <div class="date-filter">
                            <label>Pilih Tarikh:</label>
                            <input type="date" id="weekFilterDate" onchange="loadWeeklySchedule()">
                        </div>
                        <button class="btn-primary" onclick="exportWeeklyPDF()"><i class="fas fa-file-pdf"></i> Export PDF Buletin</button>
                    </div>
                    <div id="weekly-schedule-container"></div>
                </div>

                <div id="tab-urus-tim" class="content-tab">
                    <h3>Pengurusan Data Tim Pelayanan</h3>
                    <div class="card-form">
                        <h4>Tambah / Kemaskini Ahli</h4>
                        <form id="teamForm">
                            <input type="hidden" id="teamMemberId"> 
                            <div class="form-row">
                                <div class="form-group"><label>Nama Penuh</label><input type="text" id="teamName" required></div>
                                <div class="form-group"><label>No. Telefon (ID Login)</label><input type="text" id="teamPhone" required></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Jawatan</label>
                                    <select id="teamRole" required>
                                        <option value="">-- Pilih --</option>
                                        <option value="Ahli Majlis Gereja">Ahli Majlis Gereja</option>
                                        <option value="Pengerusi Cabang Pelayanan">Pengerusi Cabang Pelayanan</option>
                                        <option value="Koordinator Kelompok Sel">Koordinator Kelompok Sel</option>
                                        <option value="PMM">PMM (Muda-Mudi)</option>
                                        <option value="P. Wanita">P. Wanita</option>
                                        <option value="PKK">PKK (Kanak-Kanak)</option>
                                        <option value="P. Wira">P. Wira</option>
                                        <option value="MASM">MASM</option>
                                    </select>
                                </div>
                                <div class="form-group"><label>Status</label>
                                    <select id="teamStatus" required>
                                        <option value="Aktif">Aktif</option>
                                        <option value="Cuti/Rehat Pelayanan">Cuti/Rehat</option>
                                        <option value="Tidak Aktif">Tidak Aktif</option>
                                    </select>
                                </div>
                            </div>
                            <div class="btn-group">
                                <button type="submit" class="btn-primary" id="btnSaveTeam">Simpan</button>
                                <button type="button" class="btn-secondary" onclick="resetTeamForm()">Batal</button>
                            </div>
                        </form>
                    </div>
                    <div class="table-responsive">
                        <table id="teamTable" class="std-table">
                            <thead><tr><th>Nama</th><th>Jawatan</th><th>Status</th><th>Tindakan</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="tab-urus-ibadah" class="content-tab">
                    <div class="tab-switcher">
                        <button class="btn-secondary active" onclick="switchSubTab('sub-ahad')">Ibadah Umum Ahad</button>
                        <button class="btn-secondary" onclick="switchSubTab('sub-doa')">Persekutuan Doa</button>
                        <button class="btn-secondary" onclick="switchSubTab('sub-khas')">Ibadah Khas</button>
                    </div>

                    <div id="sub-ahad" class="sub-tab active">
                        <form id="formAhad">
                            <h4>Jadual Ibadah Umum Ahad</h4>
                            <div class="form-group"><label>Tarikh</label><input type="date" id="dateAhad" required></div>
                            <div class="form-row">
                                <div class="form-group"><label>Pimpin Ibadah</label><select class="member-select" id="valAhadLeader"></select></div>
                                <div class="form-group"><label>Pimpin Pujian</label><select class="member-select" id="valAhadWorship"></select></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Khotbah</label><select class="member-select" id="valAhadSpeaker"></select></div>
                                <div class="form-group"><label>Doa PKK</label><select class="member-select" id="valAhadDoaPKK"></select></div>
                            </div>
                            <div class="form-group"><label>Penyambut Tetamu</label><select class="member-select" id="valAhadUsher"></select></div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="checkPerjamuan" onchange="togglePerjamuan('divPerjamuan')"> <label>Ada Perjamuan Kudus?</label>
                            </div>
                            <div id="divPerjamuan" class="hidden form-row">
                                <div class="form-group"><label>Ketua PK</label><select class="member-select" id="valAhadPK"></select></div>
                                <div class="form-group"><label>Pembantu PK</label><select class="member-select" id="valAhadAsstPK"></select></div>
                            </div>
                            <fieldset>
                                <legend>Pembacaan Alkitab</legend>
                                <div class="form-row">
                                    <div class="form-group"><label>Nama (PL)</label><select class="member-select" id="valReaderOT"></select></div>
                                    <div class="form-group"><label>Ayat (PL)</label><input type="text" id="valVerseOT" placeholder="Cth: Kejadian 1:1"></div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group"><label>Nama (PB)</label><select class="member-select" id="valReaderNT"></select></div>
                                    <div class="form-group"><label>Ayat (PB)</label><input type="text" id="valVerseNT" placeholder="Cth: Matius 1:1"></div>
                                </div>
                            </fieldset>
                            <button type="submit" class="btn-primary">Simpan Jadual Ahad</button>
                        </form>
                    </div>

                    <div id="sub-doa" class="sub-tab hidden">
                        <form id="formDoa">
                            <h4>Jadual Persekutuan Doa</h4>
                            <div class="form-group"><label>Tarikh</label><input type="date" id="dateDoa" required></div>
                            
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="checkNoDoa" onchange="toggleDoaAlt()"> 
                                <label>Tiada Persekutuan / Cuti</label>
                            </div>

                            <div id="divDoaNormal">
                                <div class="form-group"><label>Pimpin Pujian</label><select class="member-select" id="valDoaPujian"></select></div>
                                <div class="form-group"><label>Pembawa Bahan Doa</label><select class="member-select" id="valDoaBahan"></select></div>
                                <div class="form-group"><label>Renungan</label><select class="member-select" id="valDoaRenungan"></select></div>
                            </div>

                            <div id="divDoaAlt" class="hidden">
                                <div class="form-group">
                                    <label>Aktiviti / Ibadah Khas</label>
                                    <input type="text" id="valDoaActivity" placeholder="Sila isi jenis aktiviti...">
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">Simpan Jadual Doa</button>
                        </form>
                    </div>

                    <div id="sub-khas" class="sub-tab hidden">
                        <form id="formKhas">
                            <h4>Ibadah Khas / Perayaan</h4>
                            <div class="form-row">
                                <div class="form-group"><label>Jenis / Tajuk Ibadah</label><input type="text" id="valKhasName" required placeholder="Contoh: Jumaat Agung"></div>
                                <div class="form-group"><label>Tarikh</label><input type="date" id="dateKhas" required></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Pimpin Ibadah</label><select class="member-select" id="valKhasLeader"></select></div>
                                <div class="form-group"><label>Pimpin Pujian</label><select class="member-select" id="valKhasWorship"></select></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Khotbah</label><select class="member-select" id="valKhasSpeaker"></select></div>
                                <div class="form-group"><label>Doa PKK</label><select class="member-select" id="valKhasDoaPKK"></select></div>
                            </div>
                            <div class="form-group"><label>Penyambut Tetamu</label><select class="member-select" id="valKhasUsher"></select></div>
                            
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="checkPerjamuanKhas" onchange="togglePerjamuan('divPerjamuanKhas')"> <label>Ada Perjamuan Kudus?</label>
                            </div>
                            <div id="divPerjamuanKhas" class="hidden form-row">
                                <div class="form-group"><label>Ketua PK</label><select class="member-select" id="valKhasPK"></select></div>
                                <div class="form-group"><label>Pembantu PK</label><select class="member-select" id="valKhasAsstPK"></select></div>
                            </div>
                            <fieldset>
                                <legend>Pembacaan Alkitab</legend>
                                <div class="form-row">
                                    <div class="form-group"><label>Nama (PL)</label><select class="member-select" id="valKhasReaderOT"></select></div>
                                    <div class="form-group"><label>Ayat (PL)</label><input type="text" id="valKhasVerseOT"></div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group"><label>Nama (PB)</label><select class="member-select" id="valKhasReaderNT"></select></div>
                                    <div class="form-group"><label>Ayat (PB)</label><input type="text" id="valKhasVerseNT"></div>
                                </div>
                            </fieldset>
                            <div class="form-group"><label>Nota Tambahan</label><textarea id="valKhasNote" rows="2"></textarea></div>
                            <button type="submit" class="btn-primary">Simpan Ibadah Khas</button>
                        </form>
                    </div>
                </div>

                <div id="tab-urus-cabang" class="content-tab">
                    <form id="formCabang">
                        <h3>Jadual Cabang Pelayanan</h3>
                        <div class="form-row">
                            <div class="form-group"><label>Pilih Cabang</label>
                                <select id="valCabangType" onchange="toggleCabangFields()" required>
                                    <option value="Wira">Pelayanan Wira</option>
                                    <option value="Wanita">Pelayanan Wanita</option>
                                    <option value="Muda-Mudi">Pelayanan Muda-Mudi</option>
                                    <option value="Kanak-Kanak">Pelayanan Kanak-Kanak</option>
                                </select>
                            </div>
                            <div class="form-group"><label>Tarikh</label><input type="date" id="dateCabang" required></div>
                        </div>
                        <div id="fieldsStandard">
                            <div class="form-group"><label>Aktiviti</label><input type="text" id="valCabangActivity"></div>
                            <div class="form-group"><label>Pujian</label><select class="member-select" id="valCabangPujian"></select></div>
                            <div class="form-group"><label>Renungan</label><select class="member-select" id="valCabangRenungan"></select></div>
                        </div>
                        <div id="fieldsKids" class="hidden">
                            <div class="form-group"><label>Kelas Besar</label><select class="member-select" id="valKidsBig"></select></div>
                            <div class="form-group"><label>Kelas Tengah</label><select class="member-select" id="valKidsMid"></select></div>
                            <div class="form-group"><label>Kelas Kecil</label><select class="member-select" id="valKidsSmall"></select></div>
                        </div>
                        <button type="submit" class="btn-primary">Simpan Jadual Cabang</button>
                    </form>
                </div>

                <div id="tab-profile" class="content-tab">
                    <h3>Tukar Kata Laluan</h3>
                    <div class="card-form" style="max-width:500px">
                        <form id="formPassword">
                            <div class="form-group"><label>Kata Laluan Baru</label><input type="password" id="newPassword" required></div>
                            <button type="submit" class="btn-primary">Tukar</button>
                        </form>
                    </div>
                </div>

            </main>
        </div>
    </section>

    <script type="module" src="script.js"></script>
</body>
</html>
